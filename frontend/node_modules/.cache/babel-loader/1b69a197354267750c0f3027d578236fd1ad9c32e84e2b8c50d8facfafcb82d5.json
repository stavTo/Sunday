{"ast":null,"code":"import { storageService } from './async-storage.service';\nimport { httpService } from './http.service';\nconst STORAGE_KEY_LOGGEDIN_USER = 'loggedinUser';\nexport const userService = {\n  login,\n  logout,\n  signup,\n  getLoggedinUser,\n  saveLocalUser,\n  getUsers,\n  getById,\n  remove,\n  update,\n  changeScore\n};\nwindow.userService = userService;\nfunction getUsers() {\n  return storageService.query('user');\n  // return httpService.get(`user`)\n}\n\nasync function getById(userId) {\n  const user = await storageService.get('user', userId);\n  // const user = await httpService.get(`user/${userId}`)\n  return user;\n}\nfunction remove(userId) {\n  return storageService.remove('user', userId);\n  // return httpService.delete(`user/${userId}`)\n}\n\nasync function update(_ref) {\n  let {\n    _id,\n    score\n  } = _ref;\n  const user = await storageService.get('user', _id);\n  user.score = score;\n  await storageService.put('user', user);\n\n  // const user = await httpService.put(`user/${_id}`, {_id, score})\n  // Handle case in which admin updates other user's details\n  if (getLoggedinUser()._id === user._id) saveLocalUser(user);\n  return user;\n}\nasync function login(userCred) {\n  const users = await storageService.query('user');\n  const user = users.find(user => user.username === userCred.username);\n  // const user = await httpService.post('auth/login', userCred)\n  if (user) {\n    return saveLocalUser(user);\n  }\n}\nasync function signup(userCred) {\n  userCred.score = 10000;\n  if (!userCred.imgUrl) userCred.imgUrl = 'https://cdn.pixabay.com/photo/2020/07/01/12/58/icon-5359553_1280.png';\n  const user = await storageService.post('user', userCred);\n  // const user = await httpService.post('auth/signup', userCred)\n  return saveLocalUser(user);\n}\nasync function logout() {\n  sessionStorage.removeItem(STORAGE_KEY_LOGGEDIN_USER);\n  // return await httpService.post('auth/logout')\n}\n\nasync function changeScore(by) {\n  const user = getLoggedinUser();\n  if (!user) throw new Error('Not loggedin');\n  user.score = user.score + by || by;\n  await update(user);\n  return user.score;\n}\nfunction saveLocalUser(user) {\n  user = {\n    _id: user._id,\n    fullname: user.fullname,\n    imgUrl: user.imgUrl,\n    score: user.score\n  };\n  sessionStorage.setItem(STORAGE_KEY_LOGGEDIN_USER, JSON.stringify(user));\n  return user;\n}\nfunction getLoggedinUser() {\n  return JSON.parse(sessionStorage.getItem(STORAGE_KEY_LOGGEDIN_USER));\n}\n\n// ;(async ()=>{\n//     await userService.signup({fullname: 'Puki Norma', username: 'puki', password:'123',score: 10000, isAdmin: false})\n//     await userService.signup({fullname: 'Master Adminov', username: 'admin', password:'123', score: 10000, isAdmin: true})\n//     await userService.signup({fullname: 'Muki G', username: 'muki', password:'123', score: 10000})\n// })()","map":{"version":3,"names":["storageService","httpService","STORAGE_KEY_LOGGEDIN_USER","userService","login","logout","signup","getLoggedinUser","saveLocalUser","getUsers","getById","remove","update","changeScore","window","query","userId","user","get","_ref","_id","score","put","userCred","users","find","username","imgUrl","post","sessionStorage","removeItem","by","Error","fullname","setItem","JSON","stringify","parse","getItem"],"sources":["C:/Users/Roni/Desktop/Local Dev/Monday/dev/Sunday/frontend/src/services/user.service.js"],"sourcesContent":["import { storageService } from './async-storage.service'\r\nimport { httpService } from './http.service'\r\n\r\nconst STORAGE_KEY_LOGGEDIN_USER = 'loggedinUser'\r\n\r\nexport const userService = {\r\n    login,\r\n    logout,\r\n    signup,\r\n    getLoggedinUser,\r\n    saveLocalUser,\r\n    getUsers,\r\n    getById,\r\n    remove,\r\n    update,\r\n    changeScore\r\n}\r\n\r\nwindow.userService = userService\r\n\r\n\r\nfunction getUsers() {\r\n    return storageService.query('user')\r\n    // return httpService.get(`user`)\r\n}\r\n\r\n\r\n\r\nasync function getById(userId) {\r\n    const user = await storageService.get('user', userId)\r\n    // const user = await httpService.get(`user/${userId}`)\r\n    return user\r\n}\r\n\r\nfunction remove(userId) {\r\n    return storageService.remove('user', userId)\r\n    // return httpService.delete(`user/${userId}`)\r\n}\r\n\r\nasync function update({_id, score}) {\r\n    const user = await storageService.get('user', _id)\r\n    user.score = score\r\n    await storageService.put('user', user)\r\n\r\n    // const user = await httpService.put(`user/${_id}`, {_id, score})\r\n    // Handle case in which admin updates other user's details\r\n    if (getLoggedinUser()._id === user._id) saveLocalUser(user)\r\n    return user\r\n}\r\n\r\nasync function login(userCred) {\r\n    const users = await storageService.query('user')\r\n    const user = users.find(user => user.username === userCred.username)\r\n    // const user = await httpService.post('auth/login', userCred)\r\n    if (user) {\r\n        return saveLocalUser(user)\r\n    }\r\n}\r\nasync function signup(userCred) {\r\n    userCred.score = 10000\r\n    if (!userCred.imgUrl) userCred.imgUrl = 'https://cdn.pixabay.com/photo/2020/07/01/12/58/icon-5359553_1280.png'\r\n    const user = await storageService.post('user', userCred)\r\n    // const user = await httpService.post('auth/signup', userCred)\r\n    return saveLocalUser(user)\r\n}\r\nasync function logout() {\r\n    sessionStorage.removeItem(STORAGE_KEY_LOGGEDIN_USER)\r\n    // return await httpService.post('auth/logout')\r\n}\r\n\r\nasync function changeScore(by) {\r\n    const user = getLoggedinUser()\r\n    if (!user) throw new Error('Not loggedin')\r\n    user.score = user.score + by || by\r\n    await update(user)\r\n    return user.score\r\n}\r\n\r\n\r\nfunction saveLocalUser(user) {\r\n    user = {_id: user._id, fullname: user.fullname, imgUrl: user.imgUrl, score: user.score}\r\n    sessionStorage.setItem(STORAGE_KEY_LOGGEDIN_USER, JSON.stringify(user))\r\n    return user\r\n}\r\n\r\nfunction getLoggedinUser() {\r\n    return JSON.parse(sessionStorage.getItem(STORAGE_KEY_LOGGEDIN_USER))\r\n}\r\n\r\n\r\n// ;(async ()=>{\r\n//     await userService.signup({fullname: 'Puki Norma', username: 'puki', password:'123',score: 10000, isAdmin: false})\r\n//     await userService.signup({fullname: 'Master Adminov', username: 'admin', password:'123', score: 10000, isAdmin: true})\r\n//     await userService.signup({fullname: 'Muki G', username: 'muki', password:'123', score: 10000})\r\n// })()\r\n\r\n\r\n\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}